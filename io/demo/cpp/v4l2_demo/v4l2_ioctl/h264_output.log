Starting V4L2 Camera Test with H.264 FORMAT BENCHMARK...
Attempting to use MMAP for buffer management...
Device opened successfully: /dev/video0
Querying device capabilities...
Device capabilities queried successfully.
Device: bcm2835 mmal (mmal service 16.1)
Bus info: platform:bcm2835_v4l2-0
Device supports video capture and streaming.
WARNING: Failed to set buffer count: Invalid argument
Supported formats:
  0: Planar YUV 4:2:0 (0x32315559) [YU12]
  1: YUYV 4:2:2 (0x56595559) [YUYV]
  2: 24-bit RGB 8-8-8 (0x33424752) [RGB3]
  3: JFIF JPEG (0x4745504a) [JPEG]
  4: H.264 (0x34363248) [H264]
  5: Motion-JPEG (0x47504a4d) [MJPG]
  6: YVYU 4:2:2 (0x55595659) [YVYU]
  7: VYUY 4:2:2 (0x59555956) [VYUY]
  8: UYVY 4:2:2 (0x59565955) [UYVY]
  9: Y/UV 4:2:0 (0x3231564e) [NV12]
  10: 24-bit BGR 8-8-8 (0x33524742) [BGR3]
  11: Planar YVU 4:2:0 (0x32315659) [YV12]
  12: Y/VU 4:2:0 (0x3132564e) [NV21]
  13: 32-bit XBGR 8-8-8-8 (0x34325852) [RX24]

Checking supported resolutions for common formats...
  ✓ 1920x1080 supported
  ✓ 1640x1232 supported
  ✓ 1280x720 supported
  ✓ 640x480 supported
  ✓ 320x240 supported

Checking hardware capabilities...
Current allocated buffers: 0
Driver version: 6.12.25

Checking current framerate capabilities...
Current FPS: 30
Timeperframe: 1/30
Attempting to set 30 FPS...
Successfully requested 30 FPS
Actual FPS set to: 30
Getting current format...
Current format: 0x56595559 [YUYV]
Current size: 640x480
Bytes per line: 1280
Getting default format...

Trying to set 640x480 resolution with H.264 format...
H.264 format failed, falling back to YUYV: Invalid argument
Successfully set to 640x480 with YUYV (fallback)!
Final format: 640x480
Format: 0x56595559 [YUYV]
Bytes per line: 1280
Buffer size: 614400 bytes
Actual Buffer size: 614400 bytes
Allocated 4 MMAP buffers
Buffer 0 mapped: length=614400 offset=0
Buffer 1 mapped: length=614400 offset=32768
Buffer 2 mapped: length=614400 offset=65536
Buffer 3 mapped: length=614400 offset=98304
4 MMAP buffers mapped successfully.
Using MMAP for buffer management.

=== FORMAT ANALYSIS ===
Final format: 0x56595559
⚠ Fallback to YUYV format
Resolution: 640x480
========================
Starting streaming with 4 buffers (MMAP mode)...
About to call VIDIOC_STREAMON...
Streaming started (MMAP mode)
Camera streaming started. Starting FPS measurement...
Timing: VIDIOC_DQBUF took 954 us (retries: 644).
Timing: VIDIOC_DQBUF took 132 us (retries: 30).
Timing: VIDIOC_DQBUF took 1255 us (retries: 900).
Timing: VIDIOC_DQBUF took 1176 us (retries: 800).
Timing: VIDIOC_DQBUF took 1411 us (retries: 903).
Elapsed time: 1.66s, FPS: 30.03
Elapsed time: 3.33s, FPS: 30.03
Elapsed time: 5.00s, FPS: 30.02
Elapsed time: 6.66s, FPS: 30.02
Elapsed time: 8.33s, FPS: 30.01
Elapsed time: 10.00s, FPS: 30.01
Elapsed time: 11.66s, FPS: 30.01
Elapsed time: 13.33s, FPS: 30.01
Elapsed time: 14.99s, FPS: 30.01
Elapsed time: 16.66s, FPS: 30.00
Elapsed time: 18.33s, FPS: 30.01
Elapsed time: 19.99s, FPS: 30.01
Elapsed time: 21.66s, FPS: 30.01
Elapsed time: 23.33s, FPS: 30.01
Elapsed time: 24.99s, FPS: 30.01
Elapsed time: 26.66s, FPS: 30.01
Elapsed time: 28.32s, FPS: 30.01
Elapsed time: 29.99s, FPS: 30.01
Test completed after 30.00 seconds.

=== FINAL BENCHMARK RESULTS ===
Format used: YUYV
Total frames: 900
Total time: 30.00 seconds
Average FPS: 30.00
===============================
Streaming stopped.
Device closed.
